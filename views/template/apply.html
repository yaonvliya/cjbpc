<h5 class="title-row">我的借款</h5>
<div class="table-wrap">
	<table class="layui-table" id="applyTable" lay-filter="applyTable">
	</table>
	<div class="ta-c" id="applyListLaypageBox"></div>
</div>
<script type="text/html" id="applyToolBar">
	<a class="c-blue cs-p" lay-event="detail">详情</a>
	{{# if(d.loanStatus == '待发标' && !d.serviceFeeStatus && d.serviceFeeType == "pre"){ }}
		<a class="service-charge c-blue cs-p" lay-event="payServiceFee">&nbsp;&nbsp;缴服务费</a>
	{{# } }}
</script>
<script type="text/html" id="moneyTpl">
	{{ MoneyUtil.formatMoney(d.loanAmount, 2) }}
</script>
<script type="text/javascript">
	var pageSize = 10;
	$(document).ready(function () {

        layui.table.render({
            elem: '#applyTable'
            ,cols: [[
                {field:'loanApplyDate', title: '借款时间', width: 180}
                ,{field:'loanProduct', title: '借款产品', width: 140}
                ,{field:'loanAmount', title: '借款金额(元)', align: 'right', style: "text-align: right", width: '140', templet: '#moneyTpl'}
                ,{field:'loanTerm', title: '借款期限', width: 140}
                ,{field:'loanStatus', title: '借款状态', width: 140} //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
                ,{title: '操作', toolbar: '#applyToolBar', width: 180}
            ]]
            ,text: {
                none: '<div class="none-data pt-100 pb-50"><img src="../img/no_data.png"/><p class="ta-c">没有数据</p></div>' //默认：无数据。注：该属性为 layui 2.2.5 开始新增
            }
        });

        //监听工具条
        layui.table.on('tool(applyTable)', function(obj){
            var data = obj.data;
            var layEvent = obj.event;

            if(layEvent === 'detail'){ //查看
                loadTemplate("apply_detail?applyId=" + data.applyId);
            } else if(layEvent === 'payServiceFee'){ //缴纳服务费
                loadTemplate("pay_fee_order?applyId=" + data.applyId);
            }

        });

        getApplyList(1);

    });

	function getApplyList(pageNum){
	    var data = {
            pageNum: pageNum,
			pageSize: pageSize
		};
        var result = AjaxUtil.ajaxPostWithLoading(loanApiUrl.getApplyList, JSON.stringify(data));
	    if(result){
            layui.table.reload("applyTable", {
                data: result.rows
            });
            if(result.total > 0){
                initPaging(pageNum, result.total);
            }
        }
	}

    // 加载分页插件
    function initPaging(index, total) {
        layui.laypage.render({
            elem: 'applyListLaypageBox' //指向存放分页的容器，值可以是容器ID、DOM对象，不用加 # 号
            , count: total //数据总数，从服务端得到
            , limit: pageSize //每页显示的条数
            , layout: ['prev', 'page', 'next', 'count']
            , theme: '#3fabf7'
            , curr: index
            , jump: function (obj, first) {
                //首次不执行
                if (!first) {
                    $(document).scrollTop(120);
					getApplyList(obj.curr);
                }
            }
        });
    }
</script>