<h5 class="title-row">缴纳服务费</h5>

<div class="pay-row">
	<label>服务费金额：</label>
	<span id="serviceFeeAmt"></span>
	<span id="totalContributions" style="color:#75818b;"></span>
</div>
<div class="pay-row">
	<label>账户余额：</label>
	<span id="availableBalance"></span>
</div>
<div class="pay-row">
	<label>短信验证码：</label>
	<div class="input-div">
		<input type="text" id="smsCaptcha" name="smsCaptchaCode" placeholder="请输入短信验证码" />
		<button type="button" id="getSmsCodeBtn" onclick="getSmsCaptcha(this)">获取验证码</button>
	</div>
</div>
<div class="mobile-row">
	<label></label>
	<span>发送至<span id="showMobile"></span></span>
</div>

<input class="row-btn" type="button" onclick="submitPayFee()" value="立即缴费" />

<script type="text/javascript">
	var msgFlag,InterValObj;
    var applyId = BaseUtil.getUrlParams(location.hash).applyId;

    $(document).ready(function () {
        if(!applyId){
            layer.msg("参数错误");
            return;
        }

        getApplyDetail();

        var userInfo = commonAPIUtil.initUserInfo();
        if(userInfo){
            $("#showMobile").text(userInfo.safeLoginAccount);
		} else {
            return ;
		}

		$("#availableBalance").text(MoneyUtil.formatMoney(commonAPIUtil.getUserAvailableBalance(), 2) + "元");
    });

    function getSmsCaptcha(obj){
        var data = {
            captchaBizType: $_GLOBAL.msgType.PAY_FEE
        };
        AjaxUtil.ajaxPostCallBack(captchaApiUrl.getSmsCodeBindMobile, JSON.stringify(data), function (result) {
            layer.msg('发送成功');
            msgFlag = true;
            InterValObj = TimerUtil.setRemainTime(obj);
            $("#smsCaptcha").focus();
        });
    }

    function getApplyDetail() {
        var data = {
            applyId: applyId
        };
        var result = AjaxUtil.ajaxPostWithLoading(loanApiUrl.getApplyDetail, JSON.stringify(data));
        if(result){
            var info = result.data;
            var overdueDays = result.data.serviceFeeOverdueAmt;
         
            //$("#serviceFeeAmt").text(MoneyUtil.formatMoney(info.serviceFeeAmt, 2) + "元");
            $("#serviceFeeAmt").text(NumberUtil.add(info.serviceFeeAmt,info.serviceFeeOverdueAmt) + "元");
            if(overdueDays> 0){
           	$("#totalContributions").text("(含服务费滞纳金"+MoneyUtil.formatMoney(info.serviceFeeOverdueAmt, 2) + "元)");
            	
            }

						//保存服务费类型，供回调区分
            sessionStorage.setItem("serviceFeeType", info.serviceFeeType);	
            

            
        }
    }

    function submitPayFee() {
        if (!msgFlag) {
            layer.msg("请先获取短信验证码！");
            return;
        }
        var smsCaptcha = $("#smsCaptcha").val();
        if (StringUtil.isEmpty(smsCaptcha)) {
            layer.msg("请输入短信验证码！");
            $("#smsCaptcha").focus();
            return;
        }

        var data = {
            applyId: applyId,
            smsCaptchaCode: smsCaptcha
        };

        var result = AjaxUtil.ajaxPostWithLoading(loanApiUrl.payFee, JSON.stringify(data));
        if(result){
            $_GLOBAL.jumpToDeposit(result.data);
		}

    }
</script>