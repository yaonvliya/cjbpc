<h4 class="child-page-title">
    债权转让 - 转让中
    <a class="right-btn" href="javascript:goBack();">返回<i class="iconfont icon-arrow-right"></i></a>
</h4>
<div class="invest-detail transfer-ongoing">
    <h6><span></span><b>项目信息</b></h6>
    <table class="layui-table ta-c">
        <colgroup>
            <col width="150">
            <col width="200">
            <col width="150">
            <col width="200">
        </colgroup>
        <tbody>
        <tr>
            <td>项目名称</td>
            <td class="tradeName"></td>
            <td>历史年化收益率</td>
            <td class="tradeInterestRate"></td>
        </tr>
        <tr>
            <td>投资金额(元)</td>
            <td class="transferOriginAmt"></td>
            <td>预期收益(元)</td>
            <td class="remainProceedsAmt"></td>
        </tr>
        <tr>
            <td>投资期限</td>
            <td class="investTerm"></td>
            <td>回款方式</td>
            <td class="tradeRepayMethod"></td>
        </tr>
        </tbody>
    </table>
    <h6><span></span><b>回款信息</b></h6>
    <table class="layui-table ta-c">
        <colgroup>
            <col width="150">
            <col width="200">
            <col width="150">
            <col width="200">
        </colgroup>
        <tbody>
        <tr>
            <td>起息日期</td>
            <td class="">项目成立当日</td>
            <td>回款日期</td>
            <td class="nextPaybackTime"></td>
        </tr>
        <tr>
            <td>已回款期数</td>
            <td class="alreadyPaybackPeriod"></td>
            <td>下期回款日</td>
            <td class="nextRepayDate"></td>
        </tr>
        <tr>
            <td>已回款本金(元)</td>
            <td class="alreadyPaybackCapitalAmount"></td>
            <td>已累计收益(元)</td>
            <td class="alreadyPaybackProceedsAmount"></td>
        </tr>
        <tr>
            <td>待回款本金(元)</td>
            <td class="waitPaybackCapitalAmount"></td>
            <td>待收收益(元)</td>
            <td class="waitPaybackProceedsAmount"></td>
        </tr>
        </tbody>
    </table>
    <h6><span></span><b>转让信息</b></h6>
    <table class="layui-table ta-c">
        <colgroup>
            <col width="150">
            <col width="200">
            <col width="150">
            <col width="200">
        </colgroup>
        <tbody>
        <tr>
            <td>转让提交日期</td>
            <td class="transferCreateTime"></td>
            <td>转让成交日期</td>
            <td class="receiveTime"></td>
        </tr>
        <tr>
            <td>转让金额(元)</td>
            <td class="transferActualAmt"></td>
            <td>手续费(元)</td>
            <!--<td class="transferChargeAmt"></td>-->
            <td class="">--</td>
        </tr>
        </tbody>
    </table>
    <div class="transfer-detail-box">
        <p>转让截止剩余时间：<label class="cut-out-data"></label>&nbsp;天</p>
        <button id="transferCancel">取消转让</button>
    </div>
</div>
<script>
	var transferOngoing = $('.transfer-ongoing');
	$(document).ready(function () {

		if ('undefined' == typeof transferId) {
			window.location.href = "user_index.html#my_transfer";
			return false;
		}

		$('#transferCancel').click(function () {
			layer.open({
				icon: 3,
				title: '温馨提示',
				content: '是否确认取消转让',
				shadeClose: true,
				anim: 0,
				yes: function (index) {
					var data = {transferId: transferId};
					AjaxUtil.ajaxPostWithLoading(userAccountApiUrl.transferCancel, DataDeal.josnObjToString(data));
					layer.close(index);
					window.location.href = $_GLOBAL.basePath() + "/views/user/user_index.html#my_transfer"
				}
			});
		});

		AjaxUtil.ajaxPostCallBack(userAccountApiUrl.transferDetail, JSON.stringify({transferId: transferId}), function (result) {
			layui.each(result.data, function (k, v) {
				var selector = '[class="' + k + '"]';
				var elt = transferOngoing.find(selector);
				if (!v) {
					v = "- - -"
				}
				if (typeof (v) == 'string') {
					elt.text("" + v);
				} else if (typeof (v) == 'number') {
					elt.text(v);
				} else if (typeof (v) == 'object') {
					elt.text(MoneyUtil.formatMoney(v.amount));
				}
			});
			addInfo(result);
		});
	});

	function addInfo(result) {
		var data = result.data;
		transferOngoing.find('[class="tradeInterestRate"]').text(NumberUtil.transfPercentage(data.tradeInterestRate));
		transferOngoing.find('[class="tradeRepayMethod"]').text(data.tradeRepayMethod.message);
		transferOngoing.find('[class="transferCreateTime"]').text(DateUtils.longToDateString(data.transferCreateTime));
		transferOngoing.find('[class="receiveTime"]').text(DateUtils.longToDateString(data.receiveTime));
		transferOngoing.find('[class="cut-out-data"]').text(DateUtils.dateDiff("d", new Date(), data.transferExpireTime));

		transferOngoing.find('[class="alreadyPaybackCapitalAmount"]').text(MoneyUtil.formatMoney(data.alreadyPaybackCapitalAmount.amount));
		transferOngoing.find('[class="alreadyPaybackProceedsAmount"]').text(MoneyUtil.formatMoney(data.alreadyPaybackProceedsAmount.amount));
		transferOngoing.find('[class="waitPaybackCapitalAmount"]').text(MoneyUtil.formatMoney(NumberUtil.sub(data.transferActualAmt.amount,data.alreadyPaybackCapitalAmount.amount)));
		transferOngoing.find('[class="waitPaybackProceedsAmount"]').text(MoneyUtil.formatMoney(NumberUtil.sub(data.remainProceedsAmt.amount,data.alreadyPaybackProceedsAmount.amount)));

		var file = encodeURI(data.contractUrl);
		if (file) {
			$('#contractUrl').attr("href", "../../plugins/pdfJs/web/viewer.html?file=" + file);
		}
	}

</script>

